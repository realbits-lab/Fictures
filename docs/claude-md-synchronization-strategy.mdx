---
title: "CLAUDE.md Synchronization Strategy"
description: "Strategy and checklist for keeping CLAUDE.md aligned with codebase and documentation"
---

# CLAUDE.md Synchronization Strategy

## Purpose

This document provides a systematic approach to keeping `/CLAUDE.md` synchronized with the actual codebase and documentation. CLAUDE.md serves as the primary guidance document for Claude Code when working with the Fictures repository.

## Synchronization Principles

### 1. CLAUDE.md is a **Reference Hub**, Not a Duplicate

**What CLAUDE.md SHOULD contain:**
- ‚úÖ **High-level overviews** with links to detailed documentation
- ‚úÖ **Essential commands** and development workflows
- ‚úÖ **Quick reference** information for common tasks
- ‚úÖ **Critical reminders** (e.g., environment setup, naming conventions)
- ‚úÖ **Links to authoritative documentation** for deep dives

**What CLAUDE.md SHOULD NOT contain:**
- ‚ùå **Detailed API specifications** ‚Üí Link to `docs/novels/novels-development.md`
- ‚ùå **Complete system prompts** ‚Üí Link to relevant docs
- ‚ùå **Exhaustive feature descriptions** ‚Üí Link to specification files
- ‚ùå **Implementation details** ‚Üí Point to source code locations

### 2. Follow the DRY Principle (Don't Repeat Yourself)

**Single Source of Truth Hierarchy:**
```
1. Source Code (src/) - Implementation truth
2. Documentation (docs/) - Feature and API truth
3. CLAUDE.md - Overview and quick reference truth
```

**Example:**
- ‚ùå Don't duplicate entire novel generation pipeline in CLAUDE.md
- ‚úÖ Do provide a compact summary with links to `docs/novels/novels-specification.mdx` and `docs/novels/novels-development.md`

### 3. Use Progressive Disclosure

**Structure Information by Detail Level:**

**Level 1: CLAUDE.md** (What & Where)
```markdown
## Novel Generation
**System:** Adversity-Triumph Engine
**Documentation:** [docs/novels/](docs/novels/)
**Quick Reference:** 9-phase pipeline, 5-25 min generation time
```

**Level 2: Specification Docs** (What & Why)
```markdown
# Novel Generation Specification
- Core concepts and methodology
- Data model definitions
- Theoretical foundation
```

**Level 3: Development Docs** (How)
```markdown
# Novel Generation Development Guide
- API specifications
- System prompts
- Implementation details
```

**Level 4: Source Code** (Actual Implementation)
```typescript
// src/lib/novels/generation.ts
export async function generateNovel(...) { ... }
```

## Synchronization Checklist

### When to Update CLAUDE.md

Update CLAUDE.md when changes affect:

- [ ] **Project structure** (new directories, major reorganization)
- [ ] **Development commands** (new scripts, changed workflows)
- [ ] **Environment variables** (new required variables)
- [ ] **Database schema** (new core tables)
- [ ] **Core technologies** (switching AI models, databases, etc.)
- [ ] **Authentication methods** (new auth providers)
- [ ] **Testing approach** (new frameworks, new test types)
- [ ] **Documentation organization** (new major doc files or restructuring)

### What NOT to Update in CLAUDE.md

Do NOT update CLAUDE.md for:

- [ ] **Minor feature additions** ‚Üí Update feature-specific docs only
- [ ] **Bug fixes** ‚Üí Update implementation code only
- [ ] **API endpoint changes** ‚Üí Update API documentation only
- [ ] **UI component changes** ‚Üí Update component docs only
- [ ] **Performance optimizations** ‚Üí Update optimization docs only

## Synchronization Workflow

### Step 1: Identify Change Impact

Ask: "Does this change affect how someone would get started with or understand the overall project?"

- **Yes** ‚Üí Update CLAUDE.md + relevant docs
- **No** ‚Üí Update only the specific documentation files

### Step 2: Update Documentation First (if needed)

For significant changes:

1. **Update detailed documentation** in `docs/`
2. **Update CLAUDE.md** to reference the new documentation
3. **Update implementation** code

This ensures documentation-driven development.

### Step 3: Update CLAUDE.md Sections

**Standard Update Pattern:**

```markdown
## [Feature Name]

**Complete Documentation:**
- **üìñ Specification**: [docs/[feature]/specification.mdx](docs/[feature]/specification.mdx) - Core concepts
- **üîß Development**: [docs/[feature]/development.md](docs/[feature]/development.md) - Implementation guide
- **üß™ Testing**: [docs/[feature]/testing.mdx](docs/[feature]/testing.mdx) - Testing strategies

**Quick Reference:**
- **Key Point 1**: Brief description
- **Key Point 2**: Brief description
- **Commands**: Essential commands only
```

### Step 4: Verify Links

After updates, verify all links in CLAUDE.md:

```bash
# Check for broken links (example using markdown-link-check)
npx markdown-link-check CLAUDE.md
```

Or manually verify:
- [ ] All `[docs/](docs/)` links point to existing files
- [ ] All `src/` references point to real directories
- [ ] All scripts referenced exist in `scripts/`

## Regular Maintenance Schedule

### Weekly Review (if active development)

- [ ] Check if any new environment variables added ‚Üí Update CLAUDE.md
- [ ] Check if major features added ‚Üí Update relevant sections
- [ ] Verify all links still valid

### Monthly Audit

- [ ] Compare CLAUDE.md structure with actual project structure
- [ ] Check for outdated information (deprecated features, old commands)
- [ ] Verify all linked documentation files are up-to-date
- [ ] Remove any duplicated content that exists in detailed docs

### Quarterly Deep Sync

- [ ] Full review of CLAUDE.md against actual codebase
- [ ] Update project statistics (number of routes, major features)
- [ ] Review and update "Quick Reference" sections
- [ ] Verify all example code snippets still work
- [ ] Check for consistency with latest conventions

## Section-Specific Sync Rules

### Development Commands

**Trigger for update:**
- New package manager commands added to `package.json`
- New development workflow introduced
- Background process patterns changed

**Update pattern:**
```markdown
- **Development**: `dotenv --file .env.local run pnpm dev` (runs on port 3000)
- **Build**: `pnpm build`
- **Testing**: `dotenv --file .env.local run npx playwright test`
```

### Environment Variables

**Trigger for update:**
- New required environment variable added
- Environment variable renamed
- New service integration requiring credentials

**Update pattern:**
```markdown
# AI Integration
GOOGLE_GENERATIVE_AI_API_KEY=***   # Description
AI_GATEWAY_API_KEY=***             # Description
```

### Database Schema

**Trigger for update:**
- New core table added (users, stories, scenes, etc.)
- Major table removed or renamed

**Do NOT update for:**
- New columns added to existing tables ‚Üí Update schema docs only
- Index changes ‚Üí Update database optimization docs only

**Update pattern:**
```markdown
**Core Story Writing Tables:**
- **users**: User accounts with Google OAuth and email/password
- **stories**: Main story entities with metadata
- **settings**: Story-specific settings and configurations
```

### Project Structure

**Trigger for update:**
- New top-level `app/` directory added
- Major reorganization of `lib/` or `components/`
- New service layer introduced

**Update pattern:**
```markdown
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ studio/            # Story creation workspace
‚îÇ   ‚îî‚îÄ‚îÄ api/               # Global endpoints
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ novels/           # Novel generation services
```

## Anti-Patterns to Avoid

### ‚ùå Anti-Pattern 1: Duplicating Detailed Specs

**Wrong:**
```markdown
## Novel Generation

**Generation Pipeline:**
1. Story Summary Phase
   - Generate story foundation with moral framework
   - Create character archetypes with internal flaws
   - Establish three-act structure
   - System Prompt: "You are a narrative architect specializing in..."
   - Expected Output: {...}
   - Error Handling: {...}
   [... 500 more lines of detailed specs ...]
```

**Right:**
```markdown
## Novel Generation

**Documentation:** [docs/novels/novels-development.md](docs/novels/novels-development.md)

**Quick Reference:**
- 9-phase pipeline: Story Summary ‚Üí Characters ‚Üí Settings ‚Üí ... ‚Üí Images
- Generation time: 5-25 minutes
- API: `/studio/api/generation/*`
```

### ‚ùå Anti-Pattern 2: Inline Code Duplication

**Wrong:**
```markdown
## Image Optimization

```typescript
// Complete implementation copied from source
export function optimizeImage(buffer: Buffer): OptimizedSet {
  const sharp = require('sharp');
  const variants = [];
  // ... 100 lines of implementation ...
}
```
```

**Right:**
```markdown
## Image Optimization

**Service:** `src/lib/services/image-optimizer.ts`
**Documentation:** [docs/image/image-optimization.mdx](docs/image/image-optimization.mdx)

**Output:** 4 variants (AVIF, JPEG √ó mobile 1x/2x)
```

### ‚ùå Anti-Pattern 3: Stale Information

**Problem:** CLAUDE.md says "uses OpenAI GPT-4" but code now uses Gemini

**Prevention:**
- During migration, update CLAUDE.md immediately
- Add to migration checklist: "Update CLAUDE.md references"
- Run quarterly audit to catch stale info

## Automation Opportunities

### Automated Checks

Create a GitHub Action or pre-commit hook to:

1. **Check for broken links** in CLAUDE.md
```bash
npx markdown-link-check CLAUDE.md
```

2. **Verify referenced files exist**
```bash
# Example script
for file in $(grep -o 'docs/[^)]*' CLAUDE.md | sort -u); do
  if [ ! -f "$file" ]; then
    echo "ERROR: Referenced file not found: $file"
    exit 1
  fi
done
```

3. **Check for outdated environment variables**
```bash
# Compare .env.example with CLAUDE.md environment section
diff <(grep -E '^[A-Z_]+=' .env.example | cut -d= -f1 | sort) \
     <(grep -E '^[A-Z_]+=' CLAUDE.md | cut -d= -f1 | sort)
```

### Semi-Automated Updates

Use a script to extract key info from codebase:

```bash
#!/bin/bash
# scripts/sync-claude-md-stats.sh

echo "Project Routes:"
find src/app -name route.ts | wc -l

echo "Database Tables:"
grep "export const.*= pgTable" src/lib/db/schema.ts | wc -l

echo "Environment Variables:"
grep -E '^[A-Z_]+=' .env.example | wc -l
```

## Version Control Integration

### Commit Message Convention

When updating CLAUDE.md:

```
docs(claude): update [section] to reflect [change]

- Updated [specific section]
- Added reference to [new documentation]
- Removed outdated [information]

Related: [commit hash of actual change]
```

### Pull Request Checklist

For PRs that should trigger CLAUDE.md updates:

```markdown
## CLAUDE.md Update Checklist

- [ ] Does this change affect project structure? ‚Üí Update structure section
- [ ] Does this add/change environment variables? ‚Üí Update env section
- [ ] Does this change development workflow? ‚Üí Update commands section
- [ ] Does this add major feature? ‚Üí Add quick reference + link to docs
- [ ] Are all new documentation files linked from CLAUDE.md?
```

## Example: Good Synchronization Flow

**Scenario:** Adding a new "Comic Generation" feature

### 1. Create Detailed Documentation First
```
docs/comics/
‚îú‚îÄ‚îÄ comics-specification.mdx   (Core concepts)
‚îú‚îÄ‚îÄ comics-development.md      (API specs)
‚îî‚îÄ‚îÄ comics-testing.mdx         (Testing guide)
```

### 2. Update CLAUDE.md with Compact Reference
```markdown
## Comic Generation

**Complete Documentation:**
- **üìñ Specification**: [docs/comics/comics-specification.mdx](docs/comics/comics-specification.mdx)
- **üîß Development**: [docs/comics/comics-development.md](docs/comics/comics-development.md)
- **üß™ Testing**: [docs/comics/comics-testing.mdx](docs/comics/comics-testing.mdx)

**Quick Reference:**
- **API**: `/comics/api/generate-panels` (POST), `/comics/api/[sceneId]/panels` (GET)
- **Process**: Scene ‚Üí Toonplay ‚Üí Panel Layout ‚Üí Image Generation
- **Scripts**: `scripts/generate-comic-panels-api.mjs`
```

### 3. Add to Project Structure (if new directory)
```markdown
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ comics/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/           # Comic generation & retrieval API
‚îÇ   ‚îî‚îÄ‚îÄ api/               # Global API endpoints
```

### 4. Add to Navigation (if new route)
```markdown
**Key Routes:**
- Read: `/comics/{storyId}` (comic format)
```

Done! Now all details are in `docs/comics/`, and CLAUDE.md provides a quick reference with links.

## Summary

**Golden Rules for CLAUDE.md Synchronization:**

1. **Keep it high-level** - Details belong in `docs/`
2. **Link generously** - Point to authoritative sources
3. **Update together** - Change docs first, then CLAUDE.md
4. **Review regularly** - Monthly audits prevent drift
5. **Automate checks** - Use tools to verify links and references
6. **Follow DRY** - Don't duplicate what exists in detailed docs

**Key Insight:**
> CLAUDE.md is the **map**, not the **territory**. It should help navigate the project, not replace the actual documentation.

---

## Related Documentation

- [Documentation Organization](./index.mdx) - Overall docs structure
- [Novel Generation Change Protocol](./novels/schema-synchronization-strategy.mdx) - Novel-specific sync strategy
- [Contribution Guidelines](../CONTRIBUTING.md) - How to contribute changes

