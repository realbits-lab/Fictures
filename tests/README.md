# Playwright Testing Setup

This directory contains end-to-end tests for the Fictures application using Playwright.

## Prerequisites

1. Install Playwright browsers:
   ```bash
   npx playwright install
   ```

2. Start the development server:
   ```bash
   pnpm dev
   ```

## Authentication Configuration

The tests require user authentication data to be stored in `@playwright/.auth/user.json`. This file is automatically generated when you run the authentication setup, but you can also create it manually.

### Automatic Setup

Run the authentication setup to create the user file automatically:

```bash
npx playwright test --project=setup
```

This will:
- Navigate to the application
- Attempt to authenticate with test credentials  
- Save the authentication state with user data to `@playwright/.auth/user.json`

### Manual Configuration

If you need to manually create the authentication file, create `@playwright/.auth/user.json` with the following structure:

```json
{
  "cookies": [
    {
      "name": "authjs.csrf-token",
      "value": "generated-csrf-token-value",
      "domain": "localhost",
      "path": "/",
      "expires": -1,
      "httpOnly": true,
      "secure": false,
      "sameSite": "Lax"
    },
    {
      "name": "authjs.session-token",
      "value": "generated-session-token-value", 
      "domain": "localhost",
      "path": "/",
      "expires": 1234567890123,
      "httpOnly": true,
      "secure": false,
      "sameSite": "Lax"
    }
  ],
  "origins": [
    {
      "origin": "http://localhost:3000",
      "localStorage": []
    }
  ],
  "testUser": {
    "email": "your-test-email@example.com",
    "password": "your-secure-password",
    "role": "writer",
    "name": "Your Test User"
  },
  "allTestUsers": {
    "reader": {
      "email": "reader@example.com",
      "password": "reader-password",
      "role": "reader",
      "name": "Reader User"
    },
    "writer": {
      "email": "writer@example.com",
      "password": "writer-password",
      "role": "writer", 
      "name": "Writer User"
    },
    "manager": {
      "email": "admin@example.com",
      "password": "admin-password",
      "role": "manager",
      "name": "Manager User"
    }
  }
}
```

### Test User Configuration

The authentication file contains two types of user data:

1. **`testUser`**: The current active user for authenticated tests
2. **`allTestUsers`**: All available test users for role-based testing

You can customize the email addresses, passwords, and user names to match your test environment. Ensure that:

- Each user has a unique email address
- Passwords are secure (though these are just test credentials)
- The `role` field matches your application's user role system
- User names are descriptive for test identification

### Security Notes

- The `@playwright/.auth/user.json` file is automatically gitignored
- Never commit authentication data to version control
- Use different credentials for each environment (development, staging, production)
- Regularly rotate test user passwords

## Running Tests

### All Tests
```bash
npx playwright test
```

### Specific Test Categories
```bash
# API endpoint tests
npx playwright test --project=api

# Authenticated page tests  
npx playwright test --project=authenticated

# Mobile responsive tests
npx playwright test --project=mobile

# Setup only
npx playwright test --project=setup
```

### Debug Mode
```bash
# Interactive debugging
npx playwright test --debug

# UI mode for test development
npx playwright test --ui
```

## Test Structure

- **`auth.setup.ts`**: Authentication setup and user data configuration
- **`authenticated-pages.authenticated.spec.ts`**: Tests for pages requiring authentication
- **`api-endpoints.api.spec.ts`**: API security and functionality tests
- **`multi-role-testing.authenticated.spec.ts`**: Role-based access control tests  
- **`responsive-design.mobile.spec.ts`**: Mobile and responsive design tests

## Troubleshooting

### Authentication Issues
- Ensure the development server is running on `http://localhost:3000`
- Verify that test user credentials are valid in your application
- Check that the authentication file path is `@playwright/.auth/user.json`

### Test Failures
- Run with `--debug` flag to see detailed execution
- Check screenshots in `test-results/` directory
- Verify that the application routes match test expectations

### Browser Issues
- Run `npx playwright install` to update browser binaries
- Clear browser cache with `npx playwright test --project=setup` to regenerate auth data

## Contributing

When adding new tests:
1. Follow the existing naming conventions
2. Use appropriate test categories (`api`, `authenticated`, `mobile`, etc.)
3. Include descriptive test names and console logging
4. Test both success and failure scenarios
5. Ensure tests are independent and can run in any order